窗口管理
===

TCP窗口
---
概念：发送端 可发送的内容 = 接收端 ACK  &  接收端 Window

问题：

* 窗口小 -> 报文小 -> 有效负载少 -> 吞吐量低
* 提高有效负载 -> 延迟高

延时确认
---
概念：接收端延时发送ACK，和数据一起发送；可减少ACK报文数，减轻网络负载，提高吞吐量

问题：延迟高

Nagle算法
---
概念：发送端 小于SMSS的报文不允许被发送，直到所有在传数据都收到ACK

注意：Nagle算法和延时确认结合会导致短暂死锁

问题：延迟高

流量控制
---
概念：发送端过快的发送会耗尽处理慢的接收端的缓存

窗口管理作用于流量控制：
* ACK是窗口的左边界，ACK + Window就是窗口的右边界
* 窗口关闭：窗口左边界右移，右边界不变。收到ACK，但Window减小
* 窗口打开：窗口右边界右移。收到ACK，Window不变或变大
* 窗口收缩：窗口右边界左移。RFC不支持该行为

窗口通告：接收方在ACK中带Window，告知发送方可接受的数据量

零窗口：窗口通告窗口值为0
接收方会在重新获得可用缓存时，发送窗口更新。ACK不变
发送方收到零窗口后，开始一个计时器，计时器超时后，发送一个窗口探测，强制要求接收端返回ACK+Window

糊涂窗口综合征：接收方持续通告较小的窗口，导致发送方持续发送小包，吞吐量低。发送零窗口后
解决方法：
* 窗口增长到MSS或缓存空间一半之前，不允许窗口通告大于0的值
* 自动调优：通过在传数据估算设置缓存大小，提高吞吐量；大缓存可增大窗口